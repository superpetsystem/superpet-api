{
  "info": {
    "name": "SuperPet API - Auth Module",
    "description": "Collection completa para testar todos os endpoints de autenticação da SuperPet API",
    "schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json",
    "_exporter_id": "superpet-api"
  },
  "item": [
    {
      "name": "1. Register",
      "event": [
        {
          "listen": "test",
          "script": {
            "exec": [
              "if (pm.response.code === 201) {",
              "    const response = pm.response.json();",
              "    pm.collectionVariables.set('accessToken', response.accessToken);",
              "    pm.collectionVariables.set('refreshToken', response.refreshToken);",
              "    pm.collectionVariables.set('userId', response.user.id);",
              "    console.log('✅ Tokens salvos automaticamente!');",
              "}"
            ],
            "type": "text/javascript"
          }
        }
      ],
      "request": {
        "method": "POST",
        "header": [
          {
            "key": "Content-Type",
            "value": "application/json"
          }
        ],
        "body": {
          "mode": "raw",
          "raw": "{\n  \"email\": \"teste@superpet.com\",\n  \"password\": \"senha123\",\n  \"name\": \"Usuário Teste\"\n}"
        },
        "url": {
          "raw": "{{baseUrl}}/auth/register",
          "host": ["{{baseUrl}}"],
          "path": ["auth", "register"]
        },
        "description": "Cria uma nova conta de usuário.\n\n**Validações:**\n- Email deve ser válido\n- Senha mínimo 6 caracteres\n- Nome é obrigatório\n\n**Response:** Retorna accessToken, refreshToken e dados do usuário."
      },
      "response": [
        {
          "name": "Success - 201 Created",
          "originalRequest": {
            "method": "POST",
            "header": [],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"email\": \"teste@superpet.com\",\n  \"password\": \"senha123\",\n  \"name\": \"Usuário Teste\"\n}",
              "options": {
                "raw": {
                  "language": "json"
                }
              }
            },
            "url": {
              "raw": "{{baseUrl}}/auth/register",
              "host": ["{{baseUrl}}"],
              "path": ["auth", "register"]
            }
          },
          "status": "Created",
          "code": 201,
          "_postman_previewlanguage": "json",
          "header": [
            {
              "key": "Content-Type",
              "value": "application/json"
            }
          ],
          "body": "{\n  \"accessToken\": \"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiI5YjFkZWI0ZC05M2RmLTRhZDEtYTJhMi1mYzBjMmZjOThjMDEiLCJlbWFpbCI6InRlc3RlQHN1cGVycGV0LmNvbSIsImlhdCI6MTYyOTk5OTk5OSwiZXhwIjoxNjMwMDAwODk5fQ.example\",\n  \"refreshToken\": \"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiI5YjFkZWI0ZC05M2RmLTRhZDEtYTJhMi1mYzBjMmZjOThjMDEiLCJlbWFpbCI6InRlc3RlQHN1cGVycGV0LmNvbSIsImlhdCI6MTYyOTk5OTk5OSwiZXhwIjoxNjMwNjA0Nzk5fQ.example\",\n  \"user\": {\n    \"id\": \"9b1deb4d-93df-4ad1-a2a2-fc0c2fc98c01\",\n    \"email\": \"teste@superpet.com\",\n    \"name\": \"Usuário Teste\"\n  }\n}"
        },
        {
          "name": "Error - Email já existe",
          "originalRequest": {
            "method": "POST",
            "header": [],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"email\": \"teste@superpet.com\",\n  \"password\": \"senha123\",\n  \"name\": \"Usuário Teste\"\n}",
              "options": {
                "raw": {
                  "language": "json"
                }
              }
            },
            "url": {
              "raw": "{{baseUrl}}/auth/register",
              "host": ["{{baseUrl}}"],
              "path": ["auth", "register"]
            }
          },
          "status": "Conflict",
          "code": 409,
          "_postman_previewlanguage": "json",
          "header": [
            {
              "key": "Content-Type",
              "value": "application/json"
            }
          ],
          "body": "{\n  \"statusCode\": 409,\n  \"message\": \"Email already registered\",\n  \"error\": \"Conflict\"\n}"
        }
      ]
    },
    {
      "name": "2. Login",
      "event": [
        {
          "listen": "test",
          "script": {
            "exec": [
              "if (pm.response.code === 200) {",
              "    const response = pm.response.json();",
              "    pm.collectionVariables.set('accessToken', response.accessToken);",
              "    pm.collectionVariables.set('refreshToken', response.refreshToken);",
              "    pm.collectionVariables.set('userId', response.user.id);",
              "    console.log('✅ Tokens atualizados!');",
              "}"
            ],
            "type": "text/javascript"
          }
        }
      ],
      "request": {
        "method": "POST",
        "header": [
          {
            "key": "Content-Type",
            "value": "application/json"
          }
        ],
        "body": {
          "mode": "raw",
          "raw": "{\n  \"email\": \"teste@superpet.com\",\n  \"password\": \"senha123\"\n}"
        },
        "url": {
          "raw": "{{baseUrl}}/auth/login",
          "host": ["{{baseUrl}}"],
          "path": ["auth", "login"]
        },
        "description": "Faz login na aplicação com email e senha.\n\n**Response:** Retorna accessToken e refreshToken."
      },
      "response": [
        {
          "name": "Success - 200 OK",
          "originalRequest": {
            "method": "POST",
            "header": [],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"email\": \"teste@superpet.com\",\n  \"password\": \"senha123\"\n}",
              "options": {
                "raw": {
                  "language": "json"
                }
              }
            },
            "url": {
              "raw": "{{baseUrl}}/auth/login",
              "host": ["{{baseUrl}}"],
              "path": ["auth", "login"]
            }
          },
          "status": "OK",
          "code": 200,
          "_postman_previewlanguage": "json",
          "header": [
            {
              "key": "Content-Type",
              "value": "application/json"
            }
          ],
          "body": "{\n  \"accessToken\": \"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.example\",\n  \"refreshToken\": \"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.refresh_example\",\n  \"user\": {\n    \"id\": \"9b1deb4d-93df-4ad1-a2a2-fc0c2fc98c01\",\n    \"email\": \"teste@superpet.com\",\n    \"name\": \"Usuário Teste\"\n  }\n}"
        },
        {
          "name": "Error - Credenciais inválidas",
          "originalRequest": {
            "method": "POST",
            "header": [],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"email\": \"teste@superpet.com\",\n  \"password\": \"senhaErrada\"\n}",
              "options": {
                "raw": {
                  "language": "json"
                }
              }
            },
            "url": {
              "raw": "{{baseUrl}}/auth/login",
              "host": ["{{baseUrl}}"],
              "path": ["auth", "login"]
            }
          },
          "status": "Unauthorized",
          "code": 401,
          "_postman_previewlanguage": "json",
          "header": [
            {
              "key": "Content-Type",
              "value": "application/json"
            }
          ],
          "body": "{\n  \"statusCode\": 401,\n  \"message\": \"Invalid credentials\",\n  \"error\": \"Unauthorized\"\n}"
        }
      ]
    },
    {
      "name": "3. Get Profile (Me)",
      "request": {
        "method": "GET",
        "header": [
          {
            "key": "Authorization",
            "value": "Bearer {{accessToken}}",
            "type": "text"
          }
        ],
        "url": {
          "raw": "{{baseUrl}}/auth/me",
          "host": ["{{baseUrl}}"],
          "path": ["auth", "me"]
        },
        "description": "Retorna os dados do usuário autenticado.\n\n**Requer:** JWT Token válido\n\n**Response:** Dados do perfil do usuário."
      },
      "response": [
        {
          "name": "Success - 200 OK",
          "originalRequest": {
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{accessToken}}"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}/auth/me",
              "host": ["{{baseUrl}}"],
              "path": ["auth", "me"]
            }
          },
          "status": "OK",
          "code": 200,
          "_postman_previewlanguage": "json",
          "header": [
            {
              "key": "Content-Type",
              "value": "application/json"
            }
          ],
          "body": "{\n  \"id\": \"9b1deb4d-93df-4ad1-a2a2-fc0c2fc98c01\",\n  \"email\": \"teste@superpet.com\",\n  \"name\": \"Usuário Teste\",\n  \"createdAt\": \"2025-10-14T19:00:00.000Z\",\n  \"updatedAt\": \"2025-10-14T19:00:00.000Z\"\n}"
        },
        {
          "name": "Error - Token inválido",
          "originalRequest": {
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer token_invalido"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}/auth/me",
              "host": ["{{baseUrl}}"],
              "path": ["auth", "me"]
            }
          },
          "status": "Unauthorized",
          "code": 401,
          "_postman_previewlanguage": "json",
          "header": [
            {
              "key": "Content-Type",
              "value": "application/json"
            }
          ],
          "body": "{\n  \"statusCode\": 401,\n  \"message\": \"Unauthorized\"\n}"
        }
      ]
    },
    {
      "name": "4. Change Password",
      "request": {
        "method": "PATCH",
        "header": [
          {
            "key": "Authorization",
            "value": "Bearer {{accessToken}}",
            "type": "text"
          },
          {
            "key": "Content-Type",
            "value": "application/json"
          }
        ],
        "body": {
          "mode": "raw",
          "raw": "{\n  \"currentPassword\": \"senha123\",\n  \"newPassword\": \"novaSenha456\"\n}"
        },
        "url": {
          "raw": "{{baseUrl}}/auth/change-password",
          "host": ["{{baseUrl}}"],
          "path": ["auth", "change-password"]
        },
        "description": "Troca a senha do usuário autenticado.\n\n**Requer:** \n- JWT Token válido\n- Senha atual correta\n- Nova senha com mínimo 6 caracteres"
      },
      "response": [
        {
          "name": "Success - 200 OK",
          "originalRequest": {
            "method": "PATCH",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{accessToken}}"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"currentPassword\": \"senha123\",\n  \"newPassword\": \"novaSenha456\"\n}",
              "options": {
                "raw": {
                  "language": "json"
                }
              }
            },
            "url": {
              "raw": "{{baseUrl}}/auth/change-password",
              "host": ["{{baseUrl}}"],
              "path": ["auth", "change-password"]
            }
          },
          "status": "OK",
          "code": 200,
          "_postman_previewlanguage": "json",
          "header": [
            {
              "key": "Content-Type",
              "value": "application/json"
            }
          ],
          "body": "{\n  \"message\": \"Password changed successfully\"\n}"
        },
        {
          "name": "Error - Senha atual incorreta",
          "originalRequest": {
            "method": "PATCH",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{accessToken}}"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"currentPassword\": \"senhaErrada\",\n  \"newPassword\": \"novaSenha456\"\n}",
              "options": {
                "raw": {
                  "language": "json"
                }
              }
            },
            "url": {
              "raw": "{{baseUrl}}/auth/change-password",
              "host": ["{{baseUrl}}"],
              "path": ["auth", "change-password"]
            }
          },
          "status": "Unauthorized",
          "code": 401,
          "_postman_previewlanguage": "json",
          "header": [
            {
              "key": "Content-Type",
              "value": "application/json"
            }
          ],
          "body": "{\n  \"statusCode\": 401,\n  \"message\": \"Current password is incorrect\",\n  \"error\": \"Unauthorized\"\n}"
        }
      ]
    },
    {
      "name": "5. Forgot Password",
      "request": {
        "method": "POST",
        "header": [
          {
            "key": "Content-Type",
            "value": "application/json"
          }
        ],
        "body": {
          "mode": "raw",
          "raw": "{\n  \"email\": \"teste@superpet.com\"\n}"
        },
        "url": {
          "raw": "{{baseUrl}}/auth/forgot-password",
          "host": ["{{baseUrl}}"],
          "path": ["auth", "forgot-password"]
        },
        "description": "Solicita recuperação de senha.\n\n**Processo:**\n1. Gera token temporário (válido por 1 hora)\n2. Em DEV: Token aparece no console do servidor\n3. Em PROD: Token seria enviado por email\n\n**Segurança:** Sempre retorna sucesso, mesmo se email não existir."
      },
      "response": [
        {
          "name": "Success - 200 OK",
          "originalRequest": {
            "method": "POST",
            "header": [],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"email\": \"teste@superpet.com\"\n}",
              "options": {
                "raw": {
                  "language": "json"
                }
              }
            },
            "url": {
              "raw": "{{baseUrl}}/auth/forgot-password",
              "host": ["{{baseUrl}}"],
              "path": ["auth", "forgot-password"]
            }
          },
          "status": "OK",
          "code": 200,
          "_postman_previewlanguage": "json",
          "header": [
            {
              "key": "Content-Type",
              "value": "application/json"
            }
          ],
          "body": "{\n  \"message\": \"If the email exists, a password reset link has been sent\"\n}"
        }
      ]
    },
    {
      "name": "6. Reset Password",
      "request": {
        "method": "POST",
        "header": [
          {
            "key": "Content-Type",
            "value": "application/json"
          }
        ],
        "body": {
          "mode": "raw",
          "raw": "{\n  \"token\": \"COLE_AQUI_O_TOKEN_DO_CONSOLE\",\n  \"newPassword\": \"senhaNova789\"\n}"
        },
        "url": {
          "raw": "{{baseUrl}}/auth/reset-password",
          "host": ["{{baseUrl}}"],
          "path": ["auth", "reset-password"]
        },
        "description": "Reseta a senha usando token temporário.\n\n**Requer:**\n- Token válido (não expirado)\n- Nova senha com mínimo 6 caracteres\n\n**Importante:** Token é de uso único e expira em 1 hora."
      },
      "response": [
        {
          "name": "Success - 200 OK",
          "originalRequest": {
            "method": "POST",
            "header": [],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"token\": \"a1b2c3d4e5f6...\",\n  \"newPassword\": \"senhaNova789\"\n}",
              "options": {
                "raw": {
                  "language": "json"
                }
              }
            },
            "url": {
              "raw": "{{baseUrl}}/auth/reset-password",
              "host": ["{{baseUrl}}"],
              "path": ["auth", "reset-password"]
            }
          },
          "status": "OK",
          "code": 200,
          "_postman_previewlanguage": "json",
          "header": [
            {
              "key": "Content-Type",
              "value": "application/json"
            }
          ],
          "body": "{\n  \"message\": \"Password has been reset successfully\"\n}"
        },
        {
          "name": "Error - Token inválido ou expirado",
          "originalRequest": {
            "method": "POST",
            "header": [],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"token\": \"token_invalido\",\n  \"newPassword\": \"senhaNova789\"\n}",
              "options": {
                "raw": {
                  "language": "json"
                }
              }
            },
            "url": {
              "raw": "{{baseUrl}}/auth/reset-password",
              "host": ["{{baseUrl}}"],
              "path": ["auth", "reset-password"]
            }
          },
          "status": "Bad Request",
          "code": 400,
          "_postman_previewlanguage": "json",
          "header": [
            {
              "key": "Content-Type",
              "value": "application/json"
            }
          ],
          "body": "{\n  \"statusCode\": 400,\n  \"message\": \"Invalid or expired reset token\",\n  \"error\": \"Bad Request\"\n}"
        }
      ]
    },
    {
      "name": "7. Refresh Token",
      "event": [
        {
          "listen": "test",
          "script": {
            "exec": [
              "if (pm.response.code === 200) {",
              "    const response = pm.response.json();",
              "    pm.collectionVariables.set('accessToken', response.accessToken);",
              "    pm.collectionVariables.set('refreshToken', response.refreshToken);",
              "    console.log('✅ Tokens renovados!');",
              "}"
            ],
            "type": "text/javascript"
          }
        }
      ],
      "request": {
        "method": "POST",
        "header": [
          {
            "key": "Content-Type",
            "value": "application/json"
          }
        ],
        "body": {
          "mode": "raw",
          "raw": "{\n  \"refreshToken\": \"{{refreshToken}}\"\n}"
        },
        "url": {
          "raw": "{{baseUrl}}/auth/refresh",
          "host": ["{{baseUrl}}"],
          "path": ["auth", "refresh"]
        },
        "description": "Renova o accessToken usando refreshToken.\n\n**Quando usar:** Quando o accessToken expirar (15 minutos)."
      },
      "response": [
        {
          "name": "Success - 200 OK",
          "originalRequest": {
            "method": "POST",
            "header": [],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"refreshToken\": \"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...\"\n}",
              "options": {
                "raw": {
                  "language": "json"
                }
              }
            },
            "url": {
              "raw": "{{baseUrl}}/auth/refresh",
              "host": ["{{baseUrl}}"],
              "path": ["auth", "refresh"]
            }
          },
          "status": "OK",
          "code": 200,
          "_postman_previewlanguage": "json",
          "header": [
            {
              "key": "Content-Type",
              "value": "application/json"
            }
          ],
          "body": "{\n  \"accessToken\": \"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.novo_access_token\",\n  \"refreshToken\": \"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.novo_refresh_token\",\n  \"user\": {\n    \"id\": \"9b1deb4d-93df-4ad1-a2a2-fc0c2fc98c01\",\n    \"email\": \"teste@superpet.com\",\n    \"name\": \"Usuário Teste\"\n  }\n}"
        }
      ]
    },
    {
      "name": "8. Logout",
      "request": {
        "method": "POST",
        "header": [
          {
            "key": "Authorization",
            "value": "Bearer {{accessToken}}",
            "type": "text"
          }
        ],
        "url": {
          "raw": "{{baseUrl}}/auth/logout",
          "host": ["{{baseUrl}}"],
          "path": ["auth", "logout"]
        },
        "description": "Faz logout do usuário.\n\n**Processo:**\n- Invalida o refreshToken no banco\n- Força o usuário a fazer login novamente"
      },
      "response": [
        {
          "name": "Success - 200 OK",
          "originalRequest": {
            "method": "POST",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{accessToken}}"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}/auth/logout",
              "host": ["{{baseUrl}}"],
              "path": ["auth", "logout"]
            }
          },
          "status": "OK",
          "code": 200,
          "_postman_previewlanguage": "json",
          "header": [
            {
              "key": "Content-Type",
              "value": "application/json"
            }
          ],
          "body": "{\n  \"message\": \"Logout successful\"\n}"
        }
      ]
    }
  ],
  "variable": [
    {
      "key": "baseUrl",
      "value": "http://localhost:3000",
      "type": "string"
    },
    {
      "key": "accessToken",
      "value": "",
      "type": "string"
    },
    {
      "key": "refreshToken",
      "value": "",
      "type": "string"
    },
    {
      "key": "userId",
      "value": "",
      "type": "string"
    }
  ]
}

